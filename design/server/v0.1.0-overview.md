# design/server/v0.1.0-overview.md

## 목표
- poll 기반 단일 스레드 서버로 PING→PONG 왕복을 확인한다.
- CRLF 프레이밍, 512바이트 길이 제한, 송신 큐 64라인 상한을 고정한다.

## 모듈 구성
- `src/main.cpp`
  - CLI 인자 `<port> <password>`를 파싱하고 `PollServer`를 실행한다.
- `src/server.cpp` / `include/server.hpp`
  - 리스닝 소켓 설정(비차단, SO_REUSEADDR).
  - `poll()` 루프로 수락/읽기/쓰기 이벤트를 처리한다.
  - per-connection 입력 버퍼와 송신 대기열을 유지한다.
  - 명령 처리: `PING <payload>` → `PONG <payload>` 응답을 큐에 적재.
- `src/protocol/framer.cpp` / `include/protocol/framer.hpp`
  - 입력 버퍼에서 CRLF를 기준으로 라인을 추출하고, 길이 초과 여부를 판정한다.

## 이벤트 루프 요약
1. `poll()`에서 준비된 fd를 조회한다.
2. 리스닝 fd는 `accept()`를 반복 호출하고, 새 소켓을 비차단으로 전환한다.
3. 클라이언트 fd는 `recv()` 결과를 입력 버퍼에 축적한 뒤 `ExtractLines`로 라인 분리를 수행한다.
   - 512바이트 초과 시 즉시 연결을 종료한다.
4. 라인별로 간단한 파서를 거쳐 PING이면 PONG을 송신 큐에 추가한다.
   - 송신 큐가 64라인에 도달하면 클라이언트를 종료한다.
5. `POLLOUT` 이벤트 시 송신 큐를 가능한 한 전송하고, 모두 소진되면 쓰기 감시를 끈다.

## 배포/테스트 포인트
- 단위 테스트: 프레이머가 조각난 입력을 처리하는지 확인.
- E2E: 서버를 실제 포트에 띄워 PING→PONG CRLF 응답을 검증.
