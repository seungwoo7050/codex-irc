# design/server/v0.7.0-modes.md

## 개요
v0.7.0에서 채널 모드(+i/+t/+k/+o/+l)와 MODE 명령 동작을 고정한다. 모드 설정/해제 시 파라미터 처리, 권한, JOIN 거부 조건을 요약한다.

## MODE 처리 규칙
- 문법: `MODE <channel> [<modestring> [params...]]`
- 지원 모드: +i, +t, +k, +o, +l (채널 모드만)
- 파라미터 소비 순서는 모드 문자 순서대로 진행한다.
- 지원하지 않는 모드 문자는 `472`로 거부하며, 필요한 파라미터가 없으면 `461`으로 거부한다.
- 호출자는 채널 멤버여야 하며, 모드 변경은 오퍼레이터만 가능하다. 미가입자는 `442`, 권한 없으면 `482`를 돌려준다.
- `<modestring>` 없이 호출하면 현재 모드 상태를 `324`로 응답한다.

## 모드별 의미
- +i/-i (invite-only): 초대 목록에 없는 사용자의 JOIN을 `473`으로 거부한다. 파라미터 없음.
- +t/-t (토픽 보호): +t면 토픽 변경은 오퍼레이터만 가능, -t면 채널 멤버 누구나 가능. 초기값은 +t.
- +k/-k (채널 키): +k는 키 1개가 필수이며, -k는 파라미터 없이 키를 제거한다. 키가 설정되면 JOIN 두 번째 파라미터로 정확한 키를 요구하며 불일치 시 `475`로 거부한다.
- +o/-o (오퍼레이터 부여/해제): 닉네임 파라미터 필수. 대상이 채널에 없으면 `441`. -o 이후 오퍼레이터가 비면 남은 멤버 중 첫 번째를 자동 승격한다.
- +l/-l (인원 제한): +l은 양의 정수 파라미터 필수, -l은 파라미터 없이 제한 해제. 제한에 도달하면 JOIN을 `471`로 거부한다.

## 브로드캐스트와 상태
- 모드가 적용되면 `:<prefix> MODE <channel> <modestring> [params]`를 채널 멤버 전체에 브로드캐스트한다.
- 모드 조회 시는 현재 설정된 모드를 `+` 묶음으로, +k/+l은 파라미터를 함께 반환한다.
- 오퍼레이터 제거(-o) 또는 멤버 탈퇴 후 오퍼레이터가 비면 자동 승격 규칙을 통해 항상 최소 1명 이상을 유지한다.
