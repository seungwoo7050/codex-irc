# design/server/v0.6.0-channel-admin.md

## 개요
- 버전: v0.6.0
- 목표: 채널 관리 명령 TOPIC/KICK/INVITE와 오퍼레이터 권한 모델을 고정한다.
- 계약: `design/protocol/contract.md` 기준, 최초 JOIN 사용자가 오퍼레이터이며 권한 없는 시도는 `482`로 거부한다.

## 채널 상태 모델
- `ChannelState` 추가 필드
  - `operators`: 오퍼레이터 fd 집합. 비면 첫 멤버를 자동 승격.
  - `invited`: 초대된 닉네임 집합. 초대 수신 후 JOIN 시 정리.
  - `topic`/`has_topic`: 토픽 문자열과 존재 여부.
- JOIN 시 처리
  - 채널이 비어 있으면 첫 참가자를 오퍼레이터로 설정.
  - 초대 목록에 본인 닉이 있으면 제거.
- 멤버 제거(KICK/PART/연결 종료)
  - 멤버·오퍼레이터·초대 목록에서 모두 제거.
  - 멤버가 남아 있으나 오퍼레이터가 없으면 남은 첫 멤버를 승격.

## 명령 동작 요약
- TOPIC
  - 조회: 멤버만 가능, 토픽이 없으면 `331`, 있으면 `332`.
  - 설정: 오퍼레이터만 가능, 성공 시 채널 전체에 `TOPIC` 브로드캐스트.
- KICK
  - 오퍼레이터만 가능. 대상이 채널에 없으면 `441`.
  - 성공 시 `KICK`을 채널에 브로드캐스트 후 멤버십/오퍼레이터 제거.
- INVITE
  - 오퍼레이터만 가능. 대상이 이미 채널에 있으면 `443`.
  - 성공 시 호출자에게 `341`, 대상에게 `INVITE` 라인 전송 후 초대 목록에 기록.
- LIST 갱신: 토픽이 있으면 `322` 토픽 필드에 반영, 없으면 `-`.

## 테스트 커버리지
- E2E `tests/e2e/test_channel_admin.py`
  - 권한 없는 KICK 시 `482` 반환.
  - INVITE 후 초대받은 사용자가 JOIN 성공 및 브로드캐스트 확인.
  - 오퍼레이터만 TOPIC 설정 가능하며 설정/조회 브로드캐스트 및 `332` 응답 확인.
